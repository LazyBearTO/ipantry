<html>

<head>
    <title>iPantry</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
</head>

<body>

    <!-- Please visit https://www.dynamsoft.com/CustomerPortal/Portal/TrialLicense.aspx to get a trial license. -->
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@7.3.0-v2/dist/dbr.js"
        data-productKeys="t0068NQAAAIy1rO7FS1QqSPr3kTf5H0+oh6r88J3V2u9zxxuME5mWbByr4W0fk4/FdaRuEki3CMzoiQ3A+Eqm0q1MfG5FIOY="></script>

    <script>
        Dynamsoft.BarcodeReader._bUseFullFeature = true; // Control of loading min wasm or full wasm.

        // scanner for decoding video
        let scanner = null;

        // decode video from camera

        (async () => {
            scanner = await Dynamsoft.BarcodeScanner.createInstance();
            // scanner.onFrameRead = results => {
            //     console.log(results);
            // };
            scanner.onUnduplicatedRead = (txt, result) => {
                //alert(txt);
                var xmlhttp = new XMLHttpRequest();
                // xmlhttp.open("POST", "insert.php", true);
                // xmlhttp.send("scanned_txt" + txt);

                xmlhttp.open("GET", "insert.php?q=" + txt, true);
                xmlhttp.send();

                //redirect to index.html
                xmlhttp.onload = function () {
                    if (xmlhttp.status == 200) {
                        window.location = '/';
                    }
                };
                scanner.hide() = function () {

                    window.location = '/';

                };
            };
            await scanner.show();


            document.querySelector('.dbrScanner-btn-close').onclick = function () {

                console.log(document.querySelector('.dbrScanner-btn-close'));
                window.location = '/';

            }
        })();


    </script>
</body>

</html>